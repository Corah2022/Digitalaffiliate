<!DOCTYPE html>
<!-- saved from url=(0087)file:///C:/Users/DELL/Documents/Digitalaffiliate-main/Digitalaffiliate-main/shemas.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="cPHITrEUqstAzEGM0JqUpUlCbYPGFuwpiUGgBl7P">
    <meta name="keywords" content="Digitalaffiliate">
    <meta name="description" content="Digitalaffiliate">
    <link rel="canonical" href="https://topaffiliatepath.online/account/user/schemas">
    <link rel="shortcut icon" href="https://topaffiliatepath.online/account/assets/global/images/xKNEWY0BHlD3XfywyX7J.png" type="image/x-icon">
    <link rel="icon" href="https://topaffiliatepath.online/account/assets/global/images/xKNEWY0BHlD3XfywyX7J.png" type="image/x-icon">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/fontawesome.min.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/bootstrap.min.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/animate.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/owl.carousel.min.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/nice-select.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/datatables.min.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/simple-notify.min.css">
    <link rel="stylesheet" type="text/css" href="./Digitalaffiliate - All Schema_files/notify.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/custom.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/magnific-popup.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/styles.css">
    <link rel="stylesheet" href="./Digitalaffiliate - All Schema_files/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link href="./Digitalaffiliate - All Schema_files/css2" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    </head>
        <style>
        .site-head-tag {
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
        }
        .site-card, .user-ranking, .user-wallets-mobile, .all-feature-mobile, .single-card, .single-investment-plan, .transaction-des, .transaction-right {
            font-family: 'Inter', sans-serif;
        }
        i[icon-name] {
            display: inline-block;
            font-family: 'Font Awesome 6 Free';
            font-style: normal;
            font-weight: 900;
        }
        i[icon-name="moon"]::before { content: "\f186"; }
        i[icon-name="sun"]::before { content: "\f185"; }
        i[icon-name="bell-ring"]::before { content: "\f0f3"; }
        i[icon-name="user"]::before { content: "\f007"; }
        i[icon-name="setting"]::before { content: "\f013"; }
        i[icon-name="lock"]::before { content: "\f023"; }
        i[icon-name="customer-service"]::before { content: "\f0e6"; }
        i[icon-name="logout"]::before { content: "\f2f5"; }
        i[icon-name="wallet"]::before { content: "\f555"; }
        i[icon-name="landmark"]::before { content: "\f66f"; }
        i[icon-name="file-add"]::before { content: "\f15b"; }
        i[icon-name="export"]::before { content: "\f2f5"; }
        i[icon-name="appstore"]::before { content: "\f009"; }
        i[icon-name="check-square"]::before { content: "\f14a"; }
        i[icon-name="copy"]::before { content: "\f0c5"; }
        i[icon-name="inbox"]::before { content: "\f01c"; }
        i[icon-name="folder-add"]::before { content: "\f07b"; }
        i[icon-name="transaction"]::before { content: "\f0ec"; }
        i[icon-name="cloud"]::before { content: "\f0c2"; }
        i[icon-name="bank"]::before { content: "\f19c"; }
        i[icon-name="credit-card"]::before { content: "\f09d"; }
        i[icon-name="star"]::before { content: "\f005"; }
        i[icon-name="usergroup-add"]::before { content: "\f0c0"; }
        i[icon-name="tool"]::before { content: "\f0ad"; }
        i[icon-name="notification"]::before { content: "\f0f3"; }
        i[icon-name="warning"]::before { content: "\f071"; }
        i[icon-name="info-circle"]::before { content: "\f05a"; }
        i[icon-name="close"]::before { content: "\f00d"; }
        i[icon-name="fingerprint"]::before { content: "\f577"; }
        i[icon-name="backpack"]::before { content: "\f5d2"; }
        i[icon-name="money-collect"]::before { content: "\f0d6"; }
        i[icon-name="gift"]::before { content: "\f06b"; }
        i[icon-name="account-book"]::before { content: "\f02d"; }
        i[icon-name="gold"]::before { content: "\f3a5"; }
        i[icon-name="radar-chart"]::before { content: "\f201"; }
        i[icon-name="question"]::before { content: "\f059"; }
        i[icon-name="layout-dashboard"]::before { content: "\f009"; }
        i[icon-name="download"]::before { content: "\f019"; }
        i[icon-name="box"]::before { content: "\f466"; }
        i[icon-name="settings"]::before { content: "\f013"; }
        i[icon-name="check"]::before { content: "\f00c"; }
    </style>

    <title>Digitalaffiliate - All Schema </title>
</head>
<body class="dark-theme">
<script>
    var notify = {
        timeout: "5000",
    }
</script>
<!--Full Layout-->
<div class="panel-layout">
    <!--Header-->
    <div class="panel-header">
        <div class="logo">
            <a href="Digitalaffiliate_logo.png">
                <img class="logo-unfold" src="Digitalaffiliate_logo.png" alt="Logo"/>
                <img class="logo-fold" src="Digitalaffiliate_logo.png" alt="Logo"/>
            </a>
        </div>
        <div class="nav-wrap">
            <div class="nav-left">
                <button class="sidebar-toggle">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div class="mob-logo">
                    <a href="Digitalaffiliate_logo.png">
                        <img src="Digitalaffiliate_logo.png" alt="Site Name"/>
                    </a>
                </div>
            </div>
            <div class="nav-right">
                <div class="single-nav-right">
                    <div class="single-right">
                        <div class="color-switcher">
                            <i class="fa-solid fa-moon dark-icon" data-mode="dark"></i>
                            <i class="fa-solid fa-sun light-icon" data-mode="light"></i>
                        </div>
                    </div>
                    <div class="single-nav-right user-notifications64">
                        <button type="button" class="item notification-dot" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa-solid fa-bell"></i>
                      
                        </button>
                        <div class="dropdown-menu dropdown-menu-end notification-pop">
                            <div class="noti-head">Notifications</div>
                            <div class="all-noti" data-id="notificationHistory">
                                <p>Notification Not Found</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="single-right">
                        <button type="button" class="item" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fa-solid fa-user"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a href="settings.html" class="dropdown-item" type="button">
                                    <i class="fa-solid fa-gear"></i>Settings
                                </a>
                            </li>
                            
                            
                           <li class="logout">
  <form method="POST" action="index.html" id="logout-form">
    <input type="hidden" name="_token" value="9kCuipxO2Fv0Jp7SzFlGyrKtgTFJ9QLPihfrgMeQ">
    <button id="logoutBtn" type="submit" class="dropdown-item" onclick="event.preventDefault(); localStorage.clear(); document.getElementById('logout-form').submit();">
      <i class="fa-solid fa-sign-out-alt"></i> Logout
    </button>
  </form>
</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--/Header-->

    <div class="desktop-screen-show">
        <div class="side-nav">
            <div class="side-wallet-box default-wallet mb-0">
                <div class="user-balance-card">
                    <div class="wallet-name">
                        <div class="name">Account Balance</div>
                        <div class="default">Wallet</div>
                    </div>
                    <div class="wallet-info">
                        <div class="wallet-id"><i class="fa-solid fa-wallet"></i>Main Wallet</div>
                        <div class="balance">$<span data-id="mainBalance">0.00</span></div>
                    </div>
                    <div class="wallet-info">
                        <div class="wallet-id"><i class="fa-solid fa-landmark"></i>Profit Wallet</div>
                        <div class="balance">$<span data-id="profitBalance">0.00</span></div>
                    </div>
                </div>
                <div class="actions">
                    <a href="deposit.html" class="user-sidebar-btn"><i class="fa-solid fa-file-circle-plus"></i>Deposit</a>
                    <a href="shemas.html" class="user-sidebar-btn red-btn"><i class="fa-solid fa-share"></i>Invest Now</a>
                </div>
            </div>
                       <div class="side-nav-inside">
                <ul class="side-nav-menu">
                    <li class="side-nav-item">
                        <a href="dashboard.html"><i class="fa-solid fa-th"></i><span>Dashboard</span></a>
                    </li>
                    <li class="side-nav-item active">
                        <a href="shemas.html"><i class="fa-solid fa-check-square"></i><span>All Schema</span></a>
                    </li>
                    <li class="side-nav-item">
                        <a href="invest-log.html"><i class="fa-solid fa-copy"></i><span>Schema Logs</span></a>
                    </li>
                    <li class="side-nav-item">
                        <a href="transactions.html"><i class="fa-solid fa-inbox"></i><span>All Transactions</span></a>
                    </li>
                    <li class="side-nav-item">
                        <a href="deposit.html"><i class="fa-solid fa-file-circle-plus"></i><span>Add Money</span></a>
                    </li>
                    
                    <li class="side-nav-item">
                        <a href="withdraw.html"><i class="fa-solid fa-university"></i><span>Withdraw</span></a>
                    </li>
                   
                    <li class="side-nav-item">
                        <a href="settings.html"><i class="fa-solid fa-gear"></i><span>Settings</span></a>
                    </li>
                  
                    
                </ul>
            </div>
        </div>
    </div>

    <div class="page-container">
        <div class="main-content">
            <div class="section-gap">
                <div class="container-fluid">
                    <div class="row desktop-screen-show">
                        <div class="col">
                            <div class="alert site-alert alert-dismissible fade show" role="alert">
                                <div class="content">
                                    <div class="icon"><i class="fa-solid fa-exclamation-triangle"></i></div>
                                    You need to submit your <strong>KYC and Other Documents</strong> before proceeding to the system.
                                </div>
                                <div class="action">
                                    <a href="kyc.html" class="site-btn-sm grad-btn"><i class="fa-solid fa-info-circle"></i>Submit Now</a>
                                    <a href="" class="site-btn-sm red-btn ms-2" type="button" data-bs-dismiss="alert" aria-label="Close"><i class="fa-solid fa-times"></i>Later</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mobile-screen-show">
                        <div class="col-12">
                            <div class="user-kyc-mobile">
                                <i class="fa-solid fa-fingerprint kyc-star"></i>
                                Please Verify Your Identity <a href="kyc.html">Submit Now</a>
                            </div>
                        </div>
                    </div>
                    <!--Page Content-->
                    <div class="row">
                        <div class="col-xl-12">
                            <div class="site-card">
                                <div class="site-card-header">
                                    <h3 class="title">All The Schemas</h3>
                                </div>
                                <div class="site-card-body">
                                    <div class="row">
                                        <div class="col-xxl-3 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <div class="single-investment-plan">
                                                <img class="investment-plan-icon" src="https://topaffiliatepath.online/account/assets/global/images/VLrYDFQmCzLPzKWde5yA.jpg" alt=""/>
                                                <h3>BASIC PLAN</h3>
                                                <p>Daily 25%</p>
                                                <ul>
                                                    <li>Investment <span class="special">$500-$6500</span></li>
                                                    <li>Capital Back <span>Yes</span></li>
                                                    <li>Return Type <span>Period</span></li>
                                                    <li>Number of Period <span>7 Times</span></li>
                                                    <li>Profit Withdraw <span>Anytime</span></li>
                                                    <li>Cancel <span>No</span></li>
                                                </ul>
                                                <div class="holidays"><span class="star">*</span> No Profit Holidays</div>
                                                <a href="shema-preview 1.html" class="site-btn grad-btn w-100 centered"><i class="fa-solid fa-check"></i>Invest Now</a>
                                            </div>
                                        </div>
                                        <div class="col-xxl-3 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <div class="single-investment-plan">
                                                <img class="investment-plan-icon" src="https://topaffiliatepath.online/account/assets/global/images/tuv2Sszs3XmFV9fQ1ZxC.jpg" alt=""/>
                                                <h3>STANDARD PLAN</h3>
                                                <p>Daily 50%</p>
                                                <ul>
                                                    <li>Investment <span class="special">$950-$10200</span></li>
                                                    <li>Capital Back <span>Yes</span></li>
                                                    <li>Return Type <span>Period</span></li>
                                                    <li>Number of Period <span>14 Times</span></li>
                                                    <li>Profit Withdraw <span>Anytime</span></li>
                                                    <li>Cancel <span>No</span></li>
                                                </ul>
                                                <div class="holidays"><span class="star">*</span> No Profit Holidays</div>
                                                <a href="shema-preview 2.html" class="site-btn grad-btn w-100 centered"><i class="fa-solid fa-check"></i>Invest Now</a>
                                            </div>
                                        </div>
                                        <div class="col-xxl-3 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <div class="single-investment-plan">
                                                <img class="investment-plan-icon" src="https://topaffiliatepath.online/account/assets/global/images/l2f5NhOSyHNpWnZtjnbA.jpg" alt=""/>
                                                <div class="feature-plan">BEST COURSE</div>
                                                <h3>PROFESSIONAL PLAN</h3>
                                                <p>Weekly 75%</p>
                                                <ul>
                                                    <li>Investment <span class="special">$1500-$19500</span></li>
                                                    <li>Capital Back <span>Yes</span></li>
                                                    <li>Return Type <span>Period</span></li>
                                                    <li>Number of Period <span>4 Times</span></li>
                                                    <li>Profit Withdraw <span>Anytime</span></li>
                                                    <li>Cancel <span>No</span></li>
                                                </ul>
                                                <div class="holidays"><span class="star">*</span> No Profit Holidays</div>
                                                <a href="shema-preview 3.html" class="site-btn grad-btn w-100 centered"><i class="fa-solid fa-check"></i>Invest Now</a>
                                            </div>
                                        </div>
                                        <div class="col-xxl-3 col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12">
                                            <div class="single-investment-plan">
                                                <img class="investment-plan-icon" src="https://topaffiliatepath.online/account/assets/global/images/8soe2yfkPvwXIiutNo8e.jpg" alt=""/>
                                                <h3>PREMIUM PLAN</h3>
                                                <p>Weekly 100%</p>
                                                <ul>
                                                    <li>Investment <span class="special">$3000-$42900</span></li>
                                                    <li>Capital Back <span>Yes</span></li>
                                                    <li>Return Type <span>Period</span></li>
                                                    <li>Number of Period <span>6 Times</span></li>
                                                    <li>Profit Withdraw <span>Anytime</span></li>
                                                    <li>Cancel <span>No</span></li>
                                                </ul>
                                                <div class="holidays"><span class="star">*</span> No Profit Holidays</div>
                                                <a href="shema-preview 4.html" class="site-btn grad-btn w-100 centered"><i class="fa-solid fa-check"></i>Invest Now</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Show in 575px in Mobile Screen -->
   <div class="mobile-screen-show">
                <div class="bottom-appbar">
                    <a href="dashboard.html" class="active">
                        <i class="fa-solid fa-th"></i>
                    </a>
                    <a href="deposit.html" class="">
                        <i class="fa-solid fa-download"></i>
                    </a>
                    <a href="shemas.html" class="">
                        <i class="fa-solid fa-box"></i>
                    </a>
                 
                    </a>
                    <a href="settings.html" class="">
                        <i class="fa-solid fa-gear"></i>
                    </a>
                </div>
            </div>
</div>
    <script id="chatway" async="true" src="https://cdn.chatway.app/widget.js?id=GouVVYLcV6iM"></script>
<!--/Full Layout-->
<!-- Load scripts after DOM -->
  <script type="module">
    // dashboard.js (defensive + DOM-ready)
import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';
import { getDatabase, ref, get, push, set, update, onValue, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js';

const firebaseConfig = {
  apiKey: "AIzaSyDDeVKTHZqyPcOF5Zy1kifeNuY20B5mNAo",
  authDomain: "affz-53a57.firebaseapp.com",
  databaseURL: "https://affz-53a57-default-rtdb.firebaseio.com",
  projectId: "affz-53a57",
  storageBucket: "affz-53a57.firebasestorage.app",
  messagingSenderId: "918119565261",
  appId: "1:918119565261:web:169c5b2d2c21706ecb2684",
  measurementId: "G-Z9TJSJJV6K"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

document.addEventListener('DOMContentLoaded', () => {
  const debugEl = document.getElementById('dashboardDebug');

  function dbg(msg){
    if (debugEl) debugEl.textContent = msg;
    console.log('[dashboard] ', msg);
  }

  function updateUI(key, value){
    const els = document.querySelectorAll(`[data-id="${key}"]`);
    if (!els || els.length === 0) {
      // not fatal — just warn
      console.warn(`No elements with data-id="${key}" found`);
      return;
    }
    els.forEach(el => el.textContent = (value === undefined || value === null) ? '' : value);
  }

  // safe query helpers
  function safeQuery(selector){
    const el = document.querySelector(selector);
    if (!el) console.warn(`Element ${selector} not found`);
    return el;
  }

  onAuthStateChanged(auth, async user => {
    if (!user) {
      dbg('User not logged in — redirecting to login.html');
      window.location.href = 'login.html';
      return;
    }
    dbg('User logged in: ' + user.uid);

    const userRef = ref(db, `users/${user.uid}`);

    // Use onValue to keep UI live-updated
    onValue(userRef, (snap) => {
      const data = snap.exists() ? snap.val() : {};
      try {
        // Profile fields (profile may be nested under 'profile' depending on your writes)
        const profile = data.profile || data; // support both shapes
        updateUI('userName', profile.name || '');
        updateUI('userEmail', profile.email || user.email || '');
        updateUI('userPhone', profile.phone || profile.telephone || '');
        updateUI('userGender', profile.gender || '');
        updateUI('userCountry', profile.country || '');
        updateUI('userDOB', profile.dob || '');
        // createdAt might be serverTimestamp; try to format
        const createdVal = profile.createdAt || profile.created_at || profile.created || '';
        updateUI('userCreated', createdVal ? (typeof createdVal === 'number' ? new Date(createdVal).toLocaleString() : createdVal) : '');

        // Wallets may be under data.wallets or directly
        const wallets = data.wallets || { mainWallet: data.mainWallet, profitWallet: data.profitWallet } || {};
        updateUI('mainBalance', (wallets.mainWallet !== undefined) ? Number(wallets.mainWallet).toFixed(2) : Number(data.mainWallet||0).toFixed(2));
        updateUI('profitBalance', (wallets.profitWallet !== undefined) ? Number(wallets.profitWallet).toFixed(2) : Number(data.profitWallet||0).toFixed(2));

        // Totals (support both direct and nested shapes)
        updateUI('totalTransactions', data.totalTransactions || data.totals?.transactions || 0);
        updateUI('totalDeposit', (data.totalDeposit || data.totals?.deposit || 0).toFixed ? (Number(data.totalDeposit || data.totals?.deposit || 0).toFixed(2)) : (data.totalDeposit || data.totals?.deposit || 0));
        updateUI('totalInvestment', (data.totalInvestment || data.totals?.investment || 0).toFixed ? (Number(data.totalInvestment || data.totals?.investment || 0).toFixed(2)) : (data.totalInvestment || data.totals?.investment || 0));
        updateUI('totalProfit', (data.totalProfit || data.totals?.profit || 0).toFixed ? (Number(data.totalProfit || data.totals?.profit || 0).toFixed(2)) : (data.totalProfit || data.totals?.profit || 0));
        updateUI('userRank', data.rank || 'Newbie');

        // Transactions list
        const txDiv = safeQuery('[data-id="transactionHistory"]');
        if (txDiv) {
          const txs = data.transactions || data.transactions === undefined ? data.transactions : data.transactions; // flexible
          if (txs) {
            const arr = Array.isArray(txs) ? txs : Object.values(txs);
            txDiv.innerHTML = arr.sort((a,b)=> (b.createdAt||0) - (a.createdAt||0)).map(t => {
              const date = t.createdAt ? (typeof t.createdAt === 'number' ? new Date(t.createdAt).toLocaleString() : t.createdAt) : (t.date || '');
              return `<tr>
  <td>
    <div class="table-description">
      <div class="icon">
        <i class="fa-solid fa-wallet"></i>
      </div>
      <div class="description">
        <strong>${t.type || t.note || t.id}</strong>
        <div class="date">${date}</div>
      </div>
    </div>
  </td>

  <td><strong>${t.id || ''}</strong></td>

  <td>
    <div class="site-badge primary-bg">${t.type || 'Transaction'}</div>
  </td>

  <td><strong>$${Number(t.amount||0).toFixed(2)}</strong></td>

  <td><strong>$${Number(t.fee||0).toFixed(2)}</strong></td>

  <td>
    <div class="site-badge ${t.status?.toLowerCase() || ''}">
      ${t.status || ''}
    </div>
  </td>

  <td><strong>${t.source || 'System'}</strong></td>
</tr>`;
            }).join('');
          } else {
            txDiv.innerHTML = '<div class="small">No transactions yet</div>';
          }
        }

        // Investments list
        const invDiv = safeQuery('[data-id="investmentHistory"]');
        if (invDiv) {
          const invs = data.investments || {};
          const invArr = Object.values(invs);
          if (invArr.length) {
            invDiv.innerHTML = invArr.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0)).map(i=>{
              const started = i.createdAt ? (typeof i.createdAt==='number' ? new Date(i.createdAt).toLocaleString() : i.createdAt) : (i.startDate || '');
              const status = i.finished || i.status || (i.payouts && i.payouts >= (i.totalPayouts||i.times||0) ? 'finished' : 'active');
              return `<div class="single-transaction">
  <div class="transaction-left">
    <div class="transaction-des">
      <!-- Plan name -->
      <div class="transaction-title">
        ${i.plan || i.planKey || 'Plan'}
      </div>
      <!-- ID -->
      <div class="transaction-id">
        ${i.id || ''}
      </div>
      <!-- Date -->
      <div class="transaction-date">
        Started: ${started}
      </div>
    </div>
  </div>

  <div class="transaction-right">
    <!-- Amount -->
    <div class="transaction-amount">
      $${Number(i.amount || 0).toFixed(2)}
    </div>
    <!-- Fee (default 0 if not present) -->
    <div class="transaction-fee sub">
      ${i.payouts || (i.payouts?.length||0)}/${i.totalPayouts || i.times || 0} Fee
    </div>
    <!-- Gateway / Source -->
    <div class="transaction-gateway">
      ${i.source || 'System'}
    </div>
    <!-- Status -->
    <div class="transaction-status ${status?.toLowerCase() || ''}">
      ${status || ''}
    </div>
  </div>
</div>`;
            }).join('');
          } else {
            invDiv.innerHTML = '<div class="small">No investments yet</div>';
          }
        }

        // Notifications
        const notDiv = safeQuery('[data-id="notificationHistory"]');
        if (notDiv) {
          const notes = data.notifications || {};
          const noteArr = Object.values(notes);
          if (noteArr.length) {
            notDiv.innerHTML = noteArr.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0)).map(n => {
              const date = n.createdAt ? (typeof n.createdAt==='number' ? new Date(n.createdAt).toLocaleString() : n.createdAt) : (n.date || '');
              return `<div style="padding:6px;border-bottom:1px solid #eee"><strong>${n.title||n.id}</strong><div class="small">${n.body||n.message||''}</div><div class="small">${date}</div></div>`;
            }).join('');
          } else {
            notDiv.innerHTML = '<div class="small">No notifications</div>';
          }
        }
      } catch (err) {
        console.error('Error updating UI from DB snapshot', err);
        dbg('Error updating dashboard UI — see console for details');
      }
    }, (err) => {
      console.error('onValue error:', err);
      dbg('Failed to read user data: ' + err.message);
    });

    // Invest form handler (attach once)
    const investForm = document.getElementById('investForm');
    if (investForm) {
      investForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          const plan = document.getElementById('plan')?.value;
          const amount = Number(document.getElementById('amount')?.value || 0);
          if (!plan || !amount || amount <= 0) return alert('Choose valid plan and amount');

          const userSnapshot = await get(ref(db, `users/${user.uid}`));
          const userData = userSnapshot.exists() ? userSnapshot.val() : {};
          const wallets = userData.wallets || { mainWallet: userData.mainWallet, profitWallet: userData.profitWallet } || {};
          const mainBal = Number(wallets.mainWallet || 0);
          if (mainBal < amount) return alert('Insufficient main wallet balance');

          // create investment node
          const invRef = push(ref(db, `users/${user.uid}/investments`));
          const invObj = {
            id: invRef.key,
            plan,
            planKey: plan,
            amount,
            createdAt: Date.now(),
            payouts: 0,
            totalPayouts: (plan === 'basic'?7: plan === 'standard'?14: plan === 'professional'?4:6),
            finished: false
          };
          await set(invRef, invObj);

          // update wallet & totals
          const updates = {};
          updates[`users/${user.uid}/wallets/mainWallet`] = (mainBal - amount);
          updates[`users/${user.uid}/totalInvestment`] = (Number(userData.totalInvestment||0) + amount);
          updates[`users/${user.uid}/totalTransactions`] = (Number(userData.totalTransactions||0) + 1);
          await update(ref(db), updates);

          // transaction record
          const txRef = push(ref(db, `users/${user.uid}/transactions`));
          await set(txRef, { id: txRef.key, type: 'investment', amount, wallet: 'main', note: `Invested in ${plan}`, createdAt: serverTimestamp() });

          alert('Investment created');
        } catch (err) {
          console.error('Invest error', err);
          alert('Failed to create investment: ' + (err.message || 'unknown'));
        }
      });
    } else {
      console.warn('Invest form not found, skipping attachment');
    }

    // Withdraw form handler
    const withdrawForm = document.getElementById('withdrawForm');
    if (withdrawForm) {
      withdrawForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          const amt = Number(document.getElementById('withdrawAmount')?.value || 0);
          if (!amt || amt <= 0) return alert('Enter valid amount');

          const userSnapshot = await get(ref(db, `users/${user.uid}`));
          const userData = userSnapshot.exists() ? userSnapshot.val() : {};
          const wallets = userData.wallets || { mainWallet: userData.mainWallet, profitWallet: userData.profitWallet } || {};
          const profitBal = Number(wallets.profitWallet || 0);

          // your rule: check min withdraw or max — adjust here:
          const MIN_WITHDRAW = 2000; // if your rule is min 2000
          if (amt < MIN_WITHDRAW) return alert(`Minimum withdraw amount is $${MIN_WITHDRAW}`);
          if (profitBal < amt) return alert('Insufficient profit wallet balance');

          // deduct immediately and create withdrawal record (pending)
          const updates = {};
          updates[`users/${user.uid}/wallets/profitWallet`] = (profitBal - amt);
          updates[`users/${user.uid}/totalTransactions`] = (Number(userData.totalTransactions||0) + 1);
          await update(ref(db), updates);

          const wRef = push(ref(db, `users/${user.uid}/withdrawals`));
          await set(wRef, { id: wRef.key, amount: amt, createdAt: serverTimestamp(), status: 'requested' });

          const txRef = push(ref(db, `users/${user.uid}/transactions`));
          await set(txRef, { id: txRef.key, type: 'withdrawal', amount: amt, wallet: 'profit', note: 'User withdrawal request', createdAt: serverTimestamp() });

          alert('Withdrawal requested');
        } catch (err) {
          console.error('Withdraw error', err);
          alert('Withdraw failed: ' + (err.message || 'unknown'));
        }
      });
    } else {
      console.warn('Withdraw form not found, skipping attachment');
    }
  });
});
  </script>
<script type="module">
    // investment.js (defensive)
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
import { getDatabase, ref, get, update, push, set } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDeVKTHZqyPcOF5Zy1kifeNuY20B5mNAo",
  authDomain: "affz-53a57.firebaseapp.com",
  databaseURL: "https://affz-53a57-default-rtdb.firebaseio.com",
  projectId: "affz-53a57",
  storageBucket: "affz-53a57.firebasestorage.app",
  messagingSenderId: "918119565261",
  appId: "1:918119565261:web:169c5b2d2c21706ecb2684",
  measurementId: "G-Z9TJSJJV6K"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

const plans = {
  basic: { rate: 0.25, times: 7, intervalDays: 1 },
  standard: { rate: 0.5, times: 14, intervalDays: 1 },
  professional: { rate: 0.75, times: 4, intervalDays: 7 },
  premium: { rate: 1.0, times: 6, intervalDays: 7 }
};

onAuthStateChanged(auth, async user => {
  if (!user) return;
  try {
    const userRef = ref(db, `users/${user.uid}`);
    const snap = await get(userRef);
    if (!snap.exists()) return;
    const data = snap.val();
    // iterate investments
    const invs = data.investments || {};
    let updates = {};
    let profitWallet = (data.wallets && data.wallets.profitWallet) ?? data.profitWallet ?? 0;
    let totalProfit = data.totalProfit || 0;
    let totalTransactions = data.totalTransactions || 0;

    const now = Date.now();

    for (const [invId, inv] of Object.entries(invs)) {
      if (!inv || inv.finished) continue;
      const p = plans[inv.planKey || inv.plan];
      if (!p) continue;
      // compute next payout by checking payouts count and createdAt
      const payoutsPaid = inv.payouts || 0;
      const lastPaidAt = inv.lastPayout || inv.createdAt || inv.startDate || Date.now();
      // due if enough time passed AND payoutsPaid < times
      const nextDue = (Number(lastPaidAt) || Date.now()) + p.intervalDays * 24*3600*1000;
      if (payoutsPaid < p.times && now >= nextDue) {
        const payoutAmt = Number(inv.amount || 0) * p.rate;
        profitWallet += payoutAmt;
        totalProfit += payoutAmt;
        totalTransactions += 1;

        updates[`users/${user.uid}/investments/${invId}/payouts`] = payoutsPaid + 1;
        updates[`users/${user.uid}/investments/${invId}/lastPayout`] = now;
        // create a transaction node
        const tRef = push(ref(db, `users/${user.uid}/transactions`));
        updates[`users/${user.uid}/transactions/${tRef.key}`] = { id: tRef.key, type: 'investment_payout', amount: payoutAmt, wallet: 'profit', createdAt: now };
        const nRef = push(ref(db, `users/${user.uid}/notifications`));
        updates[`users/${user.uid}/notifications/${nRef.key}`] = { id: nRef.key, title: 'Investment payout', body: `You received ${payoutAmt}`, createdAt: now, read: false };
      }

      // check if plan should be finished: payoutsPaid+1 >= times (we updated payouts above, but be safe)
      const newPayouts = (updates[`users/${user.uid}/investments/${invId}/payouts`] ?? payoutsPaid);
      if (newPayouts >= p.times && !inv.finished) {
        // return principal to profit wallet
        profitWallet += Number(inv.amount || 0);
        totalProfit += Number(inv.amount || 0);
        totalTransactions += 1;

        updates[`users/${user.uid}/investments/${invId}/finished`] = true;
        // record return transaction + notification
        const rtRef = push(ref(db, `users/${user.uid}/transactions`));
        updates[`users/${user.uid}/transactions/${rtRef.key}`] = { id: rtRef.key, type: 'investment_return', amount: Number(inv.amount||0), wallet: 'profit', createdAt: Date.now() };
        const rnRef = push(ref(db, `users/${user.uid}/notifications`));
        updates[`users/${user.uid}/notifications/${rnRef.key}`] = { id: rnRef.key, title: 'Investment finished', body: `Principal ${inv.amount} returned to profit wallet`, createdAt: Date.now(), read: false };
      }
    }

    if (Object.keys(updates).length) {
      updates[`users/${user.uid}/wallets/profitWallet`] = profitWallet;
      updates[`users/${user.uid}/totalProfit`] = totalProfit;
      updates[`users/${user.uid}/totalTransactions`] = totalTransactions;
      await update(ref(db), updates);
      console.log('Processed investment updates', updates);
    }
  } catch (err) {
    console.error('investment.js error', err);
  }
});
  </script>
  <script type="module">
    import { getAuth, signOut } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';

const auth = getAuth();

document.addEventListener('DOMContentLoaded', () => {
  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', async () => {
      try {
        await signOut(auth);
        alert('You have been logged out.');
        window.location.href = 'login.html'; // redirect to login page
      } catch (err) {
        console.error('Logout failed:', err);
        alert('Error logging out: ' + err.message);
      }
    });
  }
});

  </script>

<script src="./Digitalaffiliate - All Schema_files/jquery.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/jquery-migrate.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/bootstrap.bundle.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/scrollUp.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/owl.carousel.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/waypoints.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/jquery.counterup.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/jquery.nice-select.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/magnific-popup.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/aos.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/datatables.min.js.download" type="text/javascript" charset="utf8"></script>
<script src="./Digitalaffiliate - All Schema_files/simple-notify.min.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/main.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/cookie.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/custom.js.download"></script>
<script src="./Digitalaffiliate - All Schema_files/pusher.min.js.download"></script>
<script>
    (function ($) {
        'use strict';
        let pusherAppKey = "";
        let pusherAppCluster = "mt1";
        let soundUrl = "https://topaffiliatepath.online/account/notification-tune";
        var notification = new Pusher(pusherAppKey, {
            encrypted: true,
            cluster: pusherAppCluster,
        });
        var channel = notification.subscribe('user-notification64');
        channel.bind('notification-event', function (result) {
            playSound();
            latestNotification();
            notifyToast(result);
        });
        function latestNotification() {
            $.get('https://topaffiliatepath.online/account/user/latest-notification', function (data) {
                $('.user-notifications64').html(data);
            })
        }
        function notifyToast(data) {
            new Notify({
                status: 'info',
                title: data.data.title,
                text: data.data.notice,
                effect: 'slide',
                speed: 300,
                customClass: '',
                customIcon: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone"><path d="m3 11 18-5v12L3 14v-3z"></path><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"></path></svg>',
                showIcon: true,
                showCloseButton: true,
                autoclose: true,
                autotimeout: 9000,
                gap: 20,
                distance: 20,
                type: 1,
                position: 'right bottom',
                customWrapper: '<div><a href="' + data.data.action_url + '" class="learn-more-link">Explore<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-external-link"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg></a></div>',
            })
        }
        function playSound() {
            $.get(soundUrl, function (data) {
                var audio = new Audio(data);
                audio.play();
                audio.muted = false;
            });
        }
    })(jQuery);
</script>
<script>
    (function ($) {
        'use strict';
        $.scrollUp({
            scrollText: '<i class="fa-solid fa-caret-up"></i>',
            easingType: 'linear',
            scrollSpeed: 500,
            animation: 'fade'
        });
    })(jQuery);
</script><a id="scrollUp" href="file:///C:/Users/DELL/Documents/Digitalaffiliate-main/Digitalaffiliate-main/shemas.html#top" style="display: none; position: fixed; z-index: 2147483647;"><i class="fa-solid fa-caret-up"></i></a>
<script type="text/javascript" src="./Digitalaffiliate - All Schema_files/notify.js.download"></script>
<script>
    $(".color-switcher").on('click', function () {
        "use strict"
        $("body").toggleClass("dark-theme");
        var url = 'https://topaffiliatepath.online/account/theme-mode';
        $.get(url)
    });
</script>

</body></html>

